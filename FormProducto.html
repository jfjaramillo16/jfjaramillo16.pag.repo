<!DOCTYPE html>
<html>
  <head>
    <title>Producto</title>
  </head>

  <body>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <form action="./Script_PHP/guardar.php" method="POST" name="FormProducto">
      <fieldset id="Datos_Basicos">
        <legend>Datos Básicos</legend>

        Nombre del Producto
        <input id="Basico1" type="text" name="txtNombre" autofocus required />
        <br /><br />

        Descripción<br />
        <textarea
          id="Basico2"
          maxlength="50"
          name="txtaDescripcion"
          required
        ></textarea>

        <br /><br />
        Foto:
        <br />
        <input id="Basico3" type="file" name="foto" required />

        <br /><br />
        <input
          id="Basico4"
          type="checkbox"
          name="ckboxLogistica"
          value="Logistica"
        />Añadir información confidencial
      </fieldset>

      <br />

      <fieldset>
        <legend>Datos Económicos</legend>
        <table align="left" border="0">
          <tr>
            <td>Precio: </td>
            <td>
              <input
                id="Económico1"
                type="number"
                name="txtPrecio"
                min="100"
                max="200"
                required
              />
            </td>

            <td>$</td>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
            <td>Impuestos: </td>
            <td>
              <select name="cmbImpuesto" id="Económico2">
                <option value="4">4%</option>
                <option value="7">7%</option>
                <option value="16">16%</option>
                <option value="25">25%</option>
              </select>
            </td>
          </tr>
        </table>
        <br /><br />
        <label>Promoción</label><br />
        <input
          type="radio"
          name="rbPromocion"
          value="Ninguno"
          id="Económico3"
          checked
        />Ninguno <br />
        <input
          type="radio"
          name="rbPromocion"
          value="Gratuito"
          id="Económico3"
        />Transporte Gratuito<br />
        <input
          type="radio"
          name="rbPromocion"
          value="Descuento"
          id="Económico3"
        />Descuento 5%<br />
      </fieldset>

      <br />
      <input type="submit" name="btnGuardar" value="Guardar Cambios" />
      <input
        type="reset"
        name="btnReset"
        value="Borrar los datos introducidos"
      />
      <br /><br /><br />
      <a href="index.html">Regresar</a>
    </form>

    <!-- Validación antes de enviar -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.forms["FormProducto"];

        form.addEventListener("submit", function (e) {
          const nombre = this.txtNombre.value.trim();
          const descripcion = this.txtaDescripcion.value.trim();
          const precio = this.txtPrecio.value.trim();

          if (nombre === "" || descripcion === "" || precio === "") {
            e.preventDefault();
            alert("❌ Por favor, completa todos los campos obligatorios.");
            return;
          }

          if (descripcion.length < 10) {
            e.preventDefault();
            alert("❌ La descripción debe tener al menos 10 caracteres.");
            return;
          }

          if (precio < 100 || precio > 200) {
            e.preventDefault();
            alert("❌ El precio debe estar entre 100 y 200.");
            return;
          }

          // Guardar también en localStorage antes de enviar
          const producto = {
            nombre: nombre,
            descripcion: descripcion,
            precio: precio,
            impuesto: this.cmbImpuesto.value,
            promocion: document.querySelector(
              'input[name="rbPromocion"]:checked'
            ).value,
            foto: this.foto.files.length ? this.foto.files[0].name : "Sin foto",
            logistica: this.ckboxLogistica.checked,
          };

          localStorage.setItem("producto_guardado", JSON.stringify(producto));
          console.log("Producto guardado localmente:", producto);
          alert("✅ Producto validado y enviado correctamente.");
        });
      });
    </script>
  </body>
</html>
